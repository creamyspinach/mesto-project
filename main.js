(()=>{"use strict";var e,t=document.querySelector("#popup-add"),o=document.querySelector(".profile__text-container"),r=document.querySelector("#popup-edit"),n=o.querySelector(".profile__edit-button"),c=document.querySelector(".profile__add-button"),u=r.querySelector("#inputName"),a=r.querySelector("#inputSubtitle"),i=document.querySelectorAll(".popup__close-button"),l=Array.from(document.querySelectorAll(".popup")),s=document.querySelector(".popup-card"),p=s.querySelector(".popup__image"),d=s.querySelector(".popup__label"),f=r.querySelector(".popup__form"),_=f.querySelector(".popup__submit-button"),v=o.querySelector(".profile__title"),m=o.querySelector(".profile__subtitle"),y=(Array.from(document.querySelectorAll(".popup__form")),document.querySelector(".elements__cards")),S=t.querySelector(".popup__form"),q=S.querySelector(".popup__submit-button"),h=t.querySelector("#inputTitle"),b=t.querySelector("#inputLink"),E=document.querySelector(".profile__photo"),L=document.querySelector("#popup-delete"),C=L.querySelector(".popup__form"),g=C.querySelector(".popup__submit-button"),k=document.querySelector(".profile__photo-hover-element"),x=document.querySelector("#popup-avatar"),A=x.querySelector(".popup__form"),T=x.querySelector("#inputLink"),P=A.querySelector(".popup__submit-button"),B={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit-button",inactiveButtonClass:"popup__submit-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},D=function(e,t,o,r){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)},w=function(e,t,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""},j=function(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(o){w(e,o,t)}))},M=function(e,t){e.disabled=!0,e.classList.add(t)},N=function(e,t,o){var r=t.querySelector(o.submitButtonSelector),n=o.inactiveButtonClass;G(e)?M(r,n):function(e,t){e.disabled=!1,e.classList.remove(t)}(r,n)},G=function(e){return e.some((function(e){return!e.validity.valid}))};e=B,Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector));N(o,e,t),o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){t.validity.tooShort&&D(e,t,t.dataset.errorTooShort,o),t.validity.valueMissing?D(e,t,t.dataset.errorEmpty,o):t.validity.patternMismatch?D(e,t,t.dataset.errorPattern,o):t.validity.valid?w(e,t,o):D(e,t,t.validationMessage,o)}(e,r,t),N(o,e,t)}))}))}(t,e)}));var H,O,z={url:"https://nomoreparties.co/v1/".concat("plus-cohort-15"),headers:{authorization:"b79a7bcf-c1ec-44a0-a9b3-23fd8093a32f","Content-Type":"application/json"}},I=function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={method:e,headers:z.headers};return o&&(r.body=JSON.stringify(o)),fetch(z.url+t,r).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))},J=document.querySelector("#card-template").content;function U(e,t,o,r,n){var c=J.querySelector(".card").cloneNode(!0),u=c.querySelector(".card__image"),a=c.querySelector(".card__heart-button"),i=c.querySelector(".card__heart-counter"),l=c.querySelector(".card__delete-button");return c.querySelector(".card__subtitle").textContent=e,u.src=t,u.alt=e,i.textContent=o.length,o&&o.forEach((function(e){e._id.includes(r)&&a.classList.toggle("card__heart-button_active")})),function(e,t){e.addEventListener("click",(function(){var o=e.nextElementSibling;e.classList.toggle("card__heart-button_active"),e.classList.contains("card__heart-button_active")?function(e){return I("PUT","/cards/likes/".concat(e))}(t).then((function(e){o.textContent=e.likes.length})).catch((function(t){console.error("Ошибка: ".concat(t)),e.classList.toggle("card__heart-button_active")})):function(e){return I("DELETE","/cards/likes/".concat(e))}(t).then((function(e){o.textContent=e.likes.length})).catch((function(t){console.error("Ошибка: ".concat(t)),e.classList.toggle("card__heart-button_active")}))}))}(a,n),c.querySelector(".card__image").addEventListener("click",(function(e){var t,o;t=e.target.src,o=e.target.closest(".card").querySelector(".card__subtitle").textContent,K(s),p.src=t,d.textContent=o,p.alt=o})),c.dataset.cardId=n,H._id===r&&l.classList.add("card__delete-button_active"),l.addEventListener("click",(function(){K(L),F((function(){(function(e){return I("DELETE","/cards/".concat(e))})(n).then((function(){c.remove(),Q(L)})).catch((function(e){console.error("Ошибка: ".concat(e))})).finally((function(){g.value="Да"}))}))})),c}var F=function(e){O=e};function K(e){e.classList.add("popup_active"),document.addEventListener("keydown",R)}function Q(e){e.classList.remove("popup_active"),document.removeEventListener("keydown",R)}function R(e){"Escape"===e.key&&Q(document.querySelector(".popup_active"))}f.addEventListener("submit",(function(e){var t,o;e.preventDefault(),_.value="Сохранение...",(t=u.value,o=a.value,I("PATCH","/users/me",{name:t,about:o})).then((function(e){v.textContent=e.name,m.textContent=e.about,Q(r)})).catch((function(e){console.error("Ошибка: ".concat(e))})).finally((function(){_.value="Сохранить"}))})),S.addEventListener("submit",(function(e){var o,r;e.preventDefault(),q.value="Сохранение...",(o=h.value,r=b.value,I("POST","/cards",{name:o,link:r})).then((function(e){y.prepend(U(e.name,e.link,e.likes.length,e.owner._id,e._id)),Q(t),S.reset()})).catch((function(e){console.error("Ошибка: ".concat(e))})).finally((function(){q.value="Сохранить"}))})),A.addEventListener("submit",(function(e){var t;e.preventDefault(),P.value="Сохранение...",(t=T.value,I("PATCH","/users/me/avatar",{avatar:t})).then((function(e){E.src=e.avatar,Q(x)})).catch((function(e){console.error("Ошибка: ".concat(e))})).finally((function(){P.value="Сохранить"}))})),C.addEventListener("submit",(function(){g.value="Удаление...",O()})),n.addEventListener("click",(function(){u.value=v.textContent,a.value=m.textContent,K(r),j(r.querySelector(".popup__form"),B)})),c.addEventListener("click",(function(){K(t),j(t.querySelector(".popup__form"),B),M(t.querySelector(B.submitButtonSelector),B.inactiveButtonClass)})),k.addEventListener("click",(function(){K(x),T.value="",j(x.querySelector(".popup__form"),B)})),i.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return Q(t)}))})),l.forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup")&&Q(e)}))})),Promise.all([I("GET","/users/me"),I("GET","/cards")]).then((function(e){v.textContent=e[0].name,m.textContent=e[0].about,E.src=e[0].avatar,function(e){H=e}(e[0]),e[1].forEach((function(e){y.append(U(e.name,e.link,e.likes,e.owner._id,e._id))}))})).catch((function(e){console.error("Ошибка: ".concat(e))}))})();